<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> A chess bot is born | Kristen Such </title> <meta name="author" content="Kristen Such"> <meta name="description" content="It does make legal moves... could be groovier."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://alshedivat.github.io/blog/2025/heuristicEngine/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Kristen</span> Such </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">A chess bot is born</h1> <p class="post-meta"> Created on July 09, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a> ¬† ¬∑ ¬† <a href="/blog/tag/chess-bot"> <i class="fa-solid fa-hashtag fa-sm"></i> chess-bot</a> ¬† <a href="/blog/tag/cpp"> <i class="fa-solid fa-hashtag fa-sm"></i> cpp</a> ¬† ¬∑ ¬† <a href="/blog/category/side-projects"> <i class="fa-solid fa-tag fa-sm"></i> side-projects</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Ladies and gentleman, we have a chess engine. Here are some lessons learned since my last post.</p> <h3 id="step-1-making-the-engine-optional">Step 1: Making the Engine Optional</h3> <p>I modified the GameManager constructor to take an engineType argument with ‚Äúheuristic‚Äù as the default. That way, nothing else breaks and I can still easily add new engines in the future:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GameManager</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">playerColor</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">engineType</span> <span class="o">=</span> <span class="s">"heuristic"</span><span class="p">);</span>
</code></pre></div></div> <h3 id="step-2-link-errors-of-course">Step 2: Link Errors‚Ä¶ of Course</h3> <p>Then I realized it wouldn‚Äôt build. The compiler couldn‚Äôt find Engines::Heuristic ‚Äî unless I explicitly added engines/heuristic.cpp to every executable. Which is gross. The Better Way: CMake Libraries</p> <p>Instead of manually adding .cpp files everywhere, I did this:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">add_library</span><span class="p">(</span><span class="n">chess_core</span>
    <span class="n">board</span><span class="p">.</span><span class="n">cpp</span>
    <span class="n">move_validator</span><span class="p">.</span><span class="n">cpp</span>
    <span class="n">piece</span><span class="p">.</span><span class="n">cpp</span>
    <span class="p">...</span>
<span class="p">)</span>

<span class="n">add_library</span><span class="p">(</span><span class="n">chess_engines</span>
    <span class="n">engines</span><span class="o">/</span><span class="n">heuristic</span><span class="p">.</span><span class="n">cpp</span>
    <span class="n">engines</span><span class="o">/</span><span class="n">engine_utils</span><span class="p">.</span><span class="n">cpp</span>
<span class="p">)</span>

<span class="n">target_link_libraries</span><span class="p">(</span><span class="n">chess_engines</span> <span class="n">PUBLIC</span> <span class="n">chess_core</span><span class="p">)</span>
</code></pre></div></div> <p>What does this do?</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add_library(chess_core ...): "Compile these files into a reusable library."

target_link_libraries(chess_engines PUBLIC chess_core): "When building chess_engines, also link chess_core. And any executable that links to chess_engines will automatically inherit chess_core too."
</code></pre></div></div> <p>PUBLIC vs PRIVATE - PUBLIC: Link B into A, and let anything using A also see B. - PRIVATE: Link B into A, but don‚Äôt expose B to A‚Äôs users.</p> <p>Since chess_engines depends on chess_core, and anything using engines also needs the core types (e.g. Board, Piece), this is a case for PUBLIC.</p> <p>Why separate engines into their own library at all? - I thought it would allow for independent testing of the future engines - I want to unit test chess_core without dragging in evaluation code</p> <h3 id="building-the-heuristic-engine">Building the Heuristic Engine</h3> <p>The core of the engine is standard alpha-beta pruning over a 3-ply tree. I moved getAllLegalMoves() into a shared engine_utils.cpp and added evaluateBoard() plus alphaBeta(‚Ä¶).</p> <p>int alphaBeta(Board&amp; board, int depth, int alpha, int beta, bool maximizing, std::string color);</p> <p>I also threw in some simple piece-square tables and material weights ‚Äî nothing fancy yet, just enough for the engine to not blunder pawns immediately.</p> <p>Then I found it wasn‚Äôt letting me make legal moves. All the pawn move histories had 1 move or more in them.</p> <p>Turns out, doing:</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Board</span> <span class="n">simulatedBoard</span> <span class="o">=</span> <span class="n">board</span><span class="p">;</span>
<span class="n">simulatedBoard</span><span class="p">.</span><span class="n">movePiece</span><span class="p">(...);</span>
</code></pre></div></div> <p>was not safe ‚Äî because Board::grid holds shared_ptr<piece> and the Piece objects were being mutated (e.g., their moveHistory updated).</piece></p> <h2 id="the-fix-deep-copy-constructor">The Fix: Deep Copy Constructor</h2> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Board</span><span class="o">::</span><span class="n">Board</span><span class="p">(</span><span class="k">const</span> <span class="n">Board</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">grid</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Piece</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">8</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="o">++</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">grid</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Piece</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">other</span><span class="p">.</span><span class="n">grid</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now Board simulatedBoard = board; creates a full deep copy, and the engine stops breaking the actual game.</p> <p>Now it runs but slow. Really slow.</p> <p>Evaluation works. The bot plays legal moves. The engine chooses ‚Ä¶ interesting choices. But it‚Äôs slow. Like 100 seconds per move slow. Most of that time is probably spent inside alphaBeta recomputing the same things.</p> <p>Ideas for improvements</p> <ul> <li>Transposition table</li> <li>Iterative deepening</li> <li>Further move pruning</li> </ul> <p>It does make moves though. We‚Äôre on our way.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/chessbot1-480.webp 480w,/assets/img/chessbot1-800.webp 800w,/assets/img/chessbot1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/chessbot1.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="screenshot1" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">I move first as white.</figcaption> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/chessbot2-480.webp 480w,/assets/img/chessbot2-800.webp 800w,/assets/img/chessbot2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/chessbot2.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="screenshot2" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">After 17 minutes of contemplation, the bot moves Knight to c6 - the Nimzowitsch defense!</figcaption> </figure> <p>Here I set the alpha-beta depth to 3 and the evaluation time is highly variable, but on the order of 5-15 minutes. I‚Äôm actually not sure where the non-deterministic behavior comes from‚Ä¶</p> <p>My first guess is the order of the legal moves changes each time but it could be a bug. We‚Äôll see.</p> <p>üëâ Follow along with my progress on GitHub: <a href="https://github.com/suchkristenwow/chessBot" rel="external nofollow noopener" target="_blank">chessBot</a></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/gameEngines_primer/">A Big-Picture History of Chess Bots</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/pgn_replay/">PGN Replay</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/gameOver/">game over</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/testing/">How I Learned to Stop Worrying and Love the Unit Test</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/moveValidation/">The Rules of the Game</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> ¬© Copyright 2025 Kristen Such. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>